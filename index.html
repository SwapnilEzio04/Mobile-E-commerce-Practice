<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Mobile Section</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <body class="bg-gray-100">
        <h1
            class="text-3xl sm:text-4xl md:text-5xl font-bold text-center text-black py-6">
            Mobile Lists
        </h1>

        <div
            class="main flex flex-col md:flex-row w-full max-w-7xl mx-auto bg-white shadow-lg rounded-2xl overflow-hidden">
            <!-- Filter Section -->
            <div id="filterSection"
                class="w-full md:w-[30%] bg-gray-300 px-6 py-8 space-y-5 border-b md:border-b-0 md:border-r border-gray-300">
            </div>

            <!-- Product Section -->
            <div id="productSection"
                class="w-full md:w-[70%] bg-blue-200 px-6 py-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        </div>

        <script>
            // ---------- COOKIES ----------
function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
    document.cookie = `${name}=${value};expires=${d.toUTCString()};path=/`;
}

function getCookie(name) {
    const cookies = document.cookie.split("; ");
    for (let cookie of cookies) {
        const [key, val] = cookie.split("=");
        if (key === name) return val;
    }
    return null;
}

if (!getCookie("visited")) {
    alert("Welcome! Your data will be saved locally for faster loading.");
    setCookie("visited", "true", 7);
} else {
    console.log("Welcome back!");
}

// ---------- GLOBAL VARIABLES ----------
let filterSection = document.getElementById("filterSection");
let productSection = document.getElementById("productSection");
let allMobiles = [];

// ----------  FETCH + LOCALSTORAGE ----------
async function getMobiles() {
    const cachedData = localStorage.getItem("mobilesData");

    if (cachedData) {
        console.log("Loaded data from localStorage");
        allMobiles = JSON.parse(cachedData);
        renderFiltersAndProducts(allMobiles);
        return;
    }

    console.log("Fetching data from API");
    const res = await fetch("https://68fb22ac94ec96066024bd40.mockapi.io/mobiles/products");
    const data = await res.json();
    allMobiles = data;

    // Save data to localStorage for next visits
    localStorage.setItem("mobilesData", JSON.stringify(data));

    renderFiltersAndProducts(data);
}

// ----------  RENDER FILTERS + SESSIONSTORAGE ----------
function renderFiltersAndProducts(data) {
    let allBrands = data.map((b) => b.brand);
    let uniqueBrands = [...new Set(allBrands)];
    const maxPrice = Math.ceil(Math.max(...data.map((m) => m.price)) / 1000) * 1000;

    filterSection.innerHTML = `
        <h2 class="text-2xl font-bold text-black">Brands</h2>
<div class="flex flex-col py-3 px-2 space-y-3">
  <label class="flex items-center space-x-2 text-lg font-medium text-gray-600">
    <input type="checkbox" id="selectAll" class="peer scale-125 accent-gray-400"> 
    <span class="text-gray-600 peer-checked:text-black peer-checked:font-bold transition-colors">Select All</span>
  </label>

  <label class="flex items-center space-x-2 text-lg font-medium text-gray-600">
    <input type="checkbox" id="clearAll" class="peer scale-125 accent-gray-400"> 
    <span class="text-gray-600 peer-checked:text-black peer-checked:font-bold transition-colors">Clear All</span>
  </label>

  <div class="flex flex-col space-y-2 py-2">
    ${uniqueBrands.map(
        (brand) => `
        <label class="flex items-center space-x-2 text-lg font-medium">
          <input 
            type="checkbox" 
            value="${brand}" 
            class="peer brandCheckbox scale-125 accent-gray-400"
          >
          <span class="text-gray-600 peer-checked:text-black peer-checked:font-bold transition-colors">${brand}</span>
        </label>`
    ).join("")}
  </div>
</div>


        <h2 class="text-2xl font-bold text-black mt-6">Price Range</h2>
        <div class="flex flex-col py-3 space-y-3">
          <input type="range" id="priceRange" min="0" max="${maxPrice}" step="1000" value="${maxPrice}" class="w-full accent-gray-600 cursor-pointer">
          <div class="flex justify-between text-lg font-medium">
            <span>₹0</span>
            <span id="priceValue">Up to ₹${maxPrice}</span>
          </div>
        </div>
      `;

    showMobiles(data);

    const checkboxes = document.querySelectorAll(".brandCheckbox");
    const selectAll = document.getElementById("selectAll");
    const clearAll = document.getElementById("clearAll");
    const priceRange = document.getElementById("priceRange");
    const priceValue = document.getElementById("priceValue");

    function applyFilters() {
        const selectedBrands = Array.from(document.querySelectorAll(".brandCheckbox:checked")).map((cb) => cb.value);
        const selectedPrice = parseInt(priceRange.value);

        let filtered = allMobiles.filter((mobile) => mobile.price <= selectedPrice);
        if (selectedBrands.length > 0) {
            filtered = filtered.filter((m) => selectedBrands.includes(m.brand));
        }

        showMobiles(filtered);

        // Save filters in sessionStorage 
        sessionStorage.setItem(
            "selectedFilters",
            JSON.stringify({
                brands: selectedBrands,
                price: selectedPrice,
            })
        );
    }

    // --- Checkbox events ---
    checkboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", () => {
            const selectedBrands = Array.from(document.querySelectorAll(".brandCheckbox:checked")).map((cb) => cb.value);
            selectAll.checked = selectedBrands.length === checkboxes.length;
            clearAll.checked = false;
            applyFilters();
        });
    });

    selectAll.addEventListener("change", () => {
        if (selectAll.checked) {
            clearAll.checked = false;
            checkboxes.forEach((cb) => (cb.checked = true));
        } else {
            checkboxes.forEach((cb) => (cb.checked = false));
        }
        applyFilters();
    });

    clearAll.addEventListener("change", () => {
        if (clearAll.checked) {
            selectAll.checked = false;
            checkboxes.forEach((cb) => (cb.checked = false));
        }
        applyFilters();
    });

    priceRange.addEventListener("input", () => {
        const selectedPrice = parseInt(priceRange.value);
        priceValue.textContent = `Up to ₹${selectedPrice}`;
        applyFilters();
    });

    // ---------- Restore saved session filters ----------
    const savedFilters = JSON.parse(sessionStorage.getItem("selectedFilters"));
    if (savedFilters) {
        priceRange.value = savedFilters.price;
        priceValue.textContent = `Up to ₹${savedFilters.price}`;
        savedFilters.brands.forEach((brand) => {
            const checkbox = document.querySelector(`.brandCheckbox[value="${brand}"]`);
            if (checkbox) checkbox.checked = true;
        });
        applyFilters();
    }
}

// ----------  DISPLAY PRODUCTS ----------
function showMobiles(data) {
    if (data.length === 0) {
        productSection.innerHTML = `
          <div class="col-span-full text-center mt-20">
            <h3 class="text-2xl font-bold text-gray-800">No mobiles found at this range</h3>
            <p class="text-lg text-gray-600 mt-2">Try adjusting your filters or increasing the price range.</p>
          </div>
        `;
        return;
    }

    productSection.innerHTML = data
        .map(
            (mobile) => `
          <div class="bg-white shadow-md rounded-2xl p-5 hover:shadow-xl transition-all duration-300 flex flex-col justify-between h-full">
            <div>
              <div class="overflow-hidden rounded-xl bg-gray-100 mb-4">
                <img src="${mobile.image}" alt="${mobile.model}" class="w-full h-56 object-contain p-3 transition-transform duration-300 ease-in-out hover:scale-105">
              </div>
              <h3 class="text-xl font-bold text-gray-900 line-clamp-2">${mobile.brand} ${mobile.model}</h3>
            </div>
            <p class="text-lg font-semibold text-gray-800 mt-3 text-right">₹${mobile.price}</p>
          </div>
        `
        )
        .join("");
}


getMobiles();
    </script>
    </body>

</html>